

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kết Quả Đánh Giá</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(135deg, #f9f4ff, #e8f9ff);
      min-height: 100vh;
      font-family: 'Nunito', sans-serif;
      color: #1F2937;
      overflow-x: hidden;
      padding: 0;
      position: relative;
    }
    
    .main-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }
    
    /* Background decorations */
    .bg-decoration {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.1;
      z-index: -1;
    }
    
    .bg-decoration:nth-child(1) {
      width: 300px;
      height: 300px;
      background: rgba(139, 92, 246, 0.8);
      top: -150px;
      left: -150px;
      animation: float 15s ease-in-out infinite alternate;
    }
    
    .bg-decoration:nth-child(2) {
      width: 400px;
      height: 400px;
      background: rgba(99, 102, 241, 0.6);
      bottom: -200px;
      right: -200px;
      animation: float 18s ease-in-out infinite alternate-reverse;
    }
    
    .bg-decoration:nth-child(3) {
      width: 200px;
      height: 200px;
      background: rgba(244, 114, 182, 0.7);
      bottom: 20%;
      left: 10%;
      animation: float 12s ease-in-out infinite alternate;
    }
    
    @keyframes float {
      0% { transform: translate(0, 0); }
      100% { transform: translate(30px, -30px); }
    }

    /* CSS cho phần lời khuyên */
.advice-panel {
  margin-top: 10px;
  background-color: rgba(255, 255, 255, 0.7);
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
  display: none; /* Ẩn mặc định */
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.3s ease;
}

.advice-panel.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

.advice-title {
  font-weight: 700;
  color: #4B5563;
  margin-bottom: 10px;
  font-size: 1rem;
  display: flex;
  align-items: center;
}

.advice-title svg {
  margin-right: 8px;
  flex-shrink: 0;
}

.advice-content {
  color: #4B5563;
  line-height: 1.6;
  font-size: 0.95rem;
}

.advice-content ul {
  padding-left: 20px;
  margin-top: 8px;
}

.advice-content li {
  margin-bottom: 5px;
}

/* Màu sắc cho các mức điểm khác nhau */
.advice-high {
  border-left: 3px solid #10B981;
}

.advice-medium {
  border-left: 3px solid #3B82F6;
}

.advice-low {
  border-left: 3px solid #F59E0B;
}

.advice-very-low {
  border-left: 3px solid #EF4444;
}

.advice-high .advice-title svg {
  color: #10B981;
}

.advice-medium .advice-title svg {
  color: #3B82F6;
}

.advice-low .advice-title svg {
  color: #F59E0B;
}

.advice-very-low .advice-title svg {
  color: #EF4444;
}

/* Cập nhật cho phần range-item */
.range-item {
  cursor: pointer;
}

.range-item.active {
  padding-bottom: 0; /* Để panel lời khuyên hiển thị sát bên dưới */
}
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
    }
    
    .header:after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, #8B5CF6, #EC4899);
      border-radius: 2px;
    }
    
    .header h1 {
      font-weight: 800;
      background: linear-gradient(90deg, #6366F1, #8B5CF6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0;
      font-size: 2.2rem;
    }
    
    /* Result container */
    .result-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }
    
    /* Score section */
    .score-section {
      background: linear-gradient(135deg, #6366F1, #8B5CF6);
      color: white;
      padding: 35px;
      text-align: center;
      position: relative;
    }
    
    .score-section:after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: calc(50% - 10px);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 10px solid #8B5CF6;
      z-index: 5;
    }
    
    .score-title {
      margin-bottom: 20px;
      font-size: 1.3rem;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .score-display {
      position: relative;
      display: inline-block;
    }
    
    .score-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto 15px;
      position: relative;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .score-circle:before {
      content: '';
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      background: white;
      border-radius: 50%;
      z-index: 1;
    }
    
    .score-text {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2;
    }
    
    .score-number {
      font-size: 2.8rem;
      font-weight: 800;
      color: #6366F1;
      margin-bottom: -5px;
      line-height: 1;
    }
    
    .score-label {
      font-size: 0.9rem;
      color: #6B7280;
      font-weight: 600;
    }
    
    .score-circle-fill {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: conic-gradient(#8B5CF6 0deg, #6366F1 var(--percentage, 360deg), transparent var(--percentage, 360deg), transparent 360deg);
      opacity: 0.8;
      transform-origin: center;
      animation: rotateFill 1.5s ease forwards;
    }
    
    @keyframes rotateFill {
      0% { transform: rotate(-90deg); }
      100% { transform: rotate(0deg); }
    }
    
    /* Assessment section */
    .assessment-section {
      padding: 35px;
    }
    
    .assessment-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: #1F2937;
      position: relative;
      display: inline-block;
    }
    
    .assessment-title:after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 40px;
      height: 3px;
      background: #6366F1;
      border-radius: 2px;
    }
    
    .assessment-text {
      color: #4B5563;
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 1.05rem;
      padding-bottom: 20px;
      border-bottom: 1px solid #E5E7EB;
    }
    
    /* Score ranges */
    .score-ranges {
      margin-bottom: 30px;
    }
    
    .ranges-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: #1F2937;
    }
    
    .range-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .range-item {
      position: relative;
      padding: 12px 15px 12px 35px;
      margin-bottom: 10px;
      border-radius: 10px;
      background: #F9FAFB;
      transition: all 0.3s ease;
    }
    
    .range-item:hover {
      background: #F3F4F6;
      transform: translateX(5px);
    }
    
    .range-item:before {
      content: '';
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .range-item.active {
      background: rgba(99, 102, 241, 0.05);
      border-left: 3px solid #6366F1;
      font-weight: 600;
    }
    
    .range-item:nth-child(1):before {
      background: #10B981; /* Green */
    }
    
    .range-item:nth-child(2):before {
      background: #3B82F6; /* Blue */
    }
    
    .range-item:nth-child(3):before {
      background: #F59E0B; /* Orange */
    }
    
    .range-item:nth-child(4):before {
      background: #EF4444; /* Red */
    }
    
    /* Detailed scores */
    .detailed-scores {
      margin-bottom: 30px;
    }
    
    .detailed-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: #1F2937;
    }
    
    .scores-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
    }
    
    .scores-table th {
      color: #6B7280;
      font-weight: 600;
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #E5E7EB;
    }
    
    .scores-table td {
      padding: 12px 10px;
      background: #F9FAFB;
    }
    
    .scores-table tr td:first-child {
      border-radius: 8px 0 0 8px;
      font-weight: 600;
    }
    
    .scores-table tr td:last-child {
      border-radius: 0 8px 8px 0;
      text-align: center;
      font-weight: 600;
    }
    
    .score-value {
      display: inline-block;
      width: 28px;
      height: 28px;
      line-height: 28px;
      text-align: center;
      border-radius: 50%;
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .score-value.high {
      background: #10B981; /* Green */
    }
    
    .score-value.medium {
      background: #3B82F6; /* Blue */
    }
    
    .score-value.low {
      background: #F59E0B; /* Orange */
    }
    
    .score-value.very-low {
      background: #EF4444; /* Red */
    }
    
    /* Action buttons */
    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .btn-action {
      padding: 12px 25px;
      border-radius: 10px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: #6366F1;
      color: white;
      box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
    }
    
    .btn-secondary {
      background: white;
      color: #4B5563;
      border: 1px solid #E5E7EB;
    }
    
    .btn-action:hover {
      transform: translateY(-3px);
    }
    
    .btn-primary:hover {
      background: #4F46E5;
      box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4);
    }
    
    .btn-secondary:hover {
      background: #F9FAFB;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    /* Decorative elements */
    .decorative-elements {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
    }
    
    .decoration {
      position: absolute;
      border-radius: 50%;
      background: #6366F1;
      opacity: 0.1;
    }
    
    .decoration:nth-child(1) {
      width: 30px;
      height: 30px;
      top: 10%;
      left: 10%;
      animation: floatSmall 6s ease-in-out infinite;
    }
    
    .decoration:nth-child(2) {
      width: 20px;
      height: 20px;
      top: 30%;
      right: 5%;
      animation: floatSmall 8s ease-in-out infinite 1s;
    }
    
    .decoration:nth-child(3) {
      width: 15px;
      height: 15px;
      bottom: 20%;
      left: 5%;
      animation: floatSmall 7s ease-in-out infinite 2s;
    }
    
    .decoration:nth-child(4) {
      width: 25px;
      height: 25px;
      bottom: 10%;
      right: 10%;
      animation: floatSmall 9s ease-in-out infinite 3s;
    }
    
    @keyframes floatSmall {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(15px, -15px); }
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8rem;
      }
      
      .score-section, .assessment-section {
        padding: 25px;
      }
      
      .score-circle {
        width: 120px;
        height: 120px;
      }
      
      .score-number {
        font-size: 2.3rem;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .detailed-scores {
        overflow-x: auto;
      }
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.8s ease forwards;
    }
    
    .delay-1 {
      animation-delay: 0.2s;
    }
    
    .delay-2 {
      animation-delay: 0.4s;
    }
    
    .delay-3 {
      animation-delay: 0.6s;
    }
    
    .delay-4 {
      animation-delay: 0.8s;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Background decorations -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    
    <!-- Header -->
    <div class="header fade-in">
      <h1>Kết Quả Đánh Giá</h1>
    </div>
    
    <!-- Result container -->
    <div class="result-container fade-in delay-1">
      <!-- Decorative elements -->
      <div class="decorative-elements">
        <div class="decoration"></div>
        <div class="decoration"></div>
        <div class="decoration"></div>
        <div class="decoration"></div>
      </div>
      
      <!-- Score section -->
      <div class="score-section">
        <h2 class="score-title">Điểm số của bạn</h2>
        <div class="score-display">
          <div class="score-circle">
            <div class="score-circle-fill" style="--percentage: {{ (score / 30) * 360 }}deg"></div>
            <div class="score-text">
              <div class="score-number">{{ score }}</div>
              <div class="score-label">/ 30 điểm</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Assessment section -->
      <div class="assessment-section">
        <h3 class="assessment-title fade-in delay-2">Đánh giá</h3>
        <p class="assessment-text fade-in delay-2">{{ assessment }}</p>
        
        <!-- Score ranges -->
        <!-- Cập nhật phần thang điểm đánh giá với lời khuyên -->
<div class="score-ranges fade-in delay-3">
  <h4 class="ranges-title">Thang điểm đánh giá</h4>
  <ul class="range-list">
    {% for r in assessment_ranges %}
    <li class="range-item {% if score >= r.min and score <= r.max %}active{% endif %}">
      <strong>{{ r.min }} - {{ r.max }} điểm</strong>
      <br>
      <span><b>Mức độ:</b> {{ r.meaning }}</span>
      <br>
      <span><b>Ý nghĩa:</b> {{ r.assessment }}</span>
      {% if score >= r.min and score <= r.max %}
      <div class="advice-panel active">
        <div class="advice-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 8v8" />
            <path d="M12 20h.01" />
          </svg>
          <b>Biện pháp cụ thể:</b>
        </div>
        <div class="advice-content">
          <ul>
            {% for tip in r.advice %}
            <li>{{ tip }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</div>
        
        <!-- Hiển thị chi tiết điểm dùng JavaScript -->
        <div class="detailed-scores fade-in delay-4" id="detailedScores">
          <h4 class="detailed-title">Chi tiết điểm số từng câu hỏi</h4>
          <div class="table-responsive">
            <table class="scores-table">
              <thead>
                <tr>
                  <th>Câu hỏi</th>
                  <th>Điểm số</th>
                </tr>
              </thead>
              <tbody id="scoresTableBody">
                <!-- Dữ liệu sẽ được thêm vào đây bằng JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Action buttons -->
        <div class="action-buttons fade-in delay-4">
          <button class="btn-action btn-primary" onclick="window.location.href='/'">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 12h18M3 12L9 6m-6 6l6 6"/>
            </svg>
            Quay lại trang chủ
          </button>
          <button class="btn-action btn-secondary" onclick="window.location.href='/quiz'">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 12h18m-6-6l6 6-6 6"/>
            </svg>
            Làm lại bài kiểm tra
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
        document.addEventListener('DOMContentLoaded', function() {
      let detailedScores = null;
      let detailedAnswers = null;
      // Load scores
      const s = localStorage.getItem('detailedScores');
      if (s) { try { detailedScores = JSON.parse(s); } catch {} }
      const a = localStorage.getItem('detailedAnswers');
      if (a) { try { detailedAnswers = JSON.parse(a); } catch {} }
      // URL override
      const params = new URLSearchParams(window.location.search);
      const us = params.get('detailed_scores');
      const ua = params.get('detailed_answers');
      if (us) { try { detailedScores = JSON.parse(decodeURIComponent(us)); } catch {} }
      if (ua) { try { detailedAnswers = JSON.parse(decodeURIComponent(ua)); } catch {} }
      function renderDetailedScores() {
        const tbody = document.getElementById('scoresTableBody');
        if (!tbody || !detailedScores) return;
        let idx = 1;
        Object.entries(detailedScores).forEach(([id, score]) => {
          const letter = detailedAnswers && detailedAnswers[id] ? detailedAnswers[id] : '';
          const tr = document.createElement('tr');
          // Question number
          const tdQ = document.createElement('td'); tdQ.textContent = `Câu ${idx++}`;
          // Answer letter
          const tdA = document.createElement('td'); tdA.textContent = letter;
          // Score
          const tdS = document.createElement('td');
          const span = document.createElement('span');
          span.className = `score-value ${
            score === 3 ? 'high' : score === 2 ? 'medium' : score === 1 ? 'low' : 'very-low'
          }`;
          span.textContent = score;
          tdS.appendChild(span);
          // Append
          tr.appendChild(tdQ);
          tr.appendChild(tdA);
          tr.appendChild(tdS);
          tbody.appendChild(tr);
        });
      }
      renderDetailedScores();
    });
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>