<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz H·∫•p D·∫´n</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary-color: #6366F1;
      --primary-color-dark: #4F46E5;
      --secondary-color: #8B5CF6;
      --text-dark: #1F2937;
      --text-medium: #4B5563;
      --text-light: #6B7280;
      --bg-light: #fff8f0;
      --bg-lighter: #ffeecf;
      --white: #FFFFFF;
      --gray-100: #F9FAFB;
      --gray-200: #F3F4F6;
      --gray-300: #E5E7EB;
      --gray-400: #D1D5DB;
      --danger-color: #EF4444;
      --warning-color: #F59E0B;
      --success-color: #10B981;
      --pink-color: #EC4899;
      --blue-color: #3B82F6;
    }

    body {
      background: linear-gradient(135deg, var(--bg-light), var(--bg-lighter));
      font-family: 'Nunito', sans-serif;
      min-height: 100vh;
      color: var(--text-medium);
      line-height: 1.6;
    }
    
    .main-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      padding-top: 75px; /* Space for fixed navbar */
      padding-bottom: 40px;
    }
    
    /* Fixed navigation bar */
    .quiz-nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      padding: 18px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .quiz-nav-title {
      color: var(--white);
      font-weight: 700;
      font-size: 1.3em;
    }
    
    .quiz-exit-btn {
      background-color: rgba(255, 255, 255, 0.95);
      color: var(--primary-color);
      border: none;
      padding: 9px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .quiz-exit-btn:hover {
      background-color: var(--white);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .quiz-exit-btn svg {
        width: 16px;
        height: 16px;
    }
    
    /* Quiz container with proper positioning */
    .quiz-container-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align items to the top */
      flex-grow: 1;
      position: relative;
      padding: 30px 20px;
      z-index: 2; /* Above decorative elements */
    }
    
    #quiz-selection-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 800px; 
        padding: 20px;
    }

    .quiz-selection-title {
        font-size: 2em;
        color: var(--text-dark);
        font-weight: 800;
        margin-bottom: 40px;
        text-align: center;
    }

    .quiz-options-list {
        display: flex;
        flex-direction: column;
        align-items: center; 
        width: 100%;
        gap: 20px; /* Spacing between cards */
    }

    .quiz-type-option {
        background: var(--white);
        padding: 25px 30px;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 6px solid transparent;
        display: flex;
        align-items: center;
        text-align: left;
        width: 100%;
        max-width: 650px; /* Max width for each card */
    }

    .quiz-type-option:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    }
    
    .quiz-type-option.active-option:nth-child(1) { border-color: var(--blue-color); }
    .quiz-type-option.active-option:nth-child(2) { border-color: var(--warning-color); }
    .quiz-type-option.active-option:nth-child(3) { border-color: var(--success-color); }
    .quiz-type-option.active-option:nth-child(4) { border-color: var(--pink-color); }
    .quiz-type-option.active-option:nth-child(5) { border-color: var(--secondary-color); }


    .quiz-type-option.disabled-option {
        border-color: var(--gray-400);
        cursor: not-allowed;
        opacity: 0.6;
        background-color: var(--gray-100);
    }
     .quiz-type-option.disabled-option:hover {
        transform: none;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .quiz-type-emoji {
        font-size: 2.5rem; 
        margin-right: 25px;
        line-height: 1;
    }
    
    .quiz-type-content {
        flex-grow: 1;
    }

    .quiz-type-name {
        font-size: 1.3em; 
        font-weight: 700;  
        color: var(--text-dark);
        margin-bottom: 6px;
    }
    
    .quiz-type-description {
        font-size: 0.9em; 
        color: var(--text-light);
        line-height: 1.5;
    }

    .quiz-type-arrow {
        font-size: 1.6rem;
        color: var(--gray-400);
        margin-left: 20px;
        transition: transform 0.3s ease-in-out, color 0.3s ease-in-out;
    }

    .quiz-type-option:hover .quiz-type-arrow {
        transform: translateX(5px);
    }

    .quiz-type-option.active-option:nth-child(1):hover .quiz-type-arrow { color: var(--blue-color); }
    .quiz-type-option.active-option:nth-child(2):hover .quiz-type-arrow { color: var(--warning-color); }
    .quiz-type-option.active-option:nth-child(3):hover .quiz-type-arrow { color: var(--success-color); }
    .quiz-type-option.active-option:nth-child(4):hover .quiz-type-arrow { color: var(--pink-color); }
    .quiz-type-option.active-option:nth-child(5):hover .quiz-type-arrow { color: var(--secondary-color); }
    .quiz-type-option.disabled-option:hover .quiz-type-arrow { color: var(--gray-400); transform: none; }


    .quiz-container {
      width: 100%;
      max-width: 700px;
      background: var(--white);
      padding: 35px 40px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
      position: relative;
      opacity: 0; /* For fade-in animation */
      transform: translateY(20px); /* For slide-in animation */
    }
    
    .quiz-container.visible {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }

    /* Decorative emoji positioning */
    .decorative-elements {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }
    
    .emoji {
      position: absolute;
      font-size: 3rem;
      animation: float 6s ease-in-out infinite alternate;
      opacity: 0.6;
    }
    
    .emoji-top-left { top: 15%; left: 5%; animation-delay: 0s; }
    .emoji-top-right { top: 20%; right: 5%; animation-delay: -1.5s; }
    .emoji-bottom-left { bottom: 10%; left: 8%; animation-delay: -3s; }
    .emoji-bottom-right { bottom: 15%; right: 8%; animation-delay: -4.5s; }
    
    @keyframes float {
      0% { transform: translateY(0px) rotate(-5deg); }
      100% { transform: translateY(-25px) rotate(5deg); }
    }
    
    /* Quiz title */
    .quiz-title {
      font-size: 1.1em;
      color: var(--text-light);
      margin-bottom: 10px;
      font-weight: 600;
      text-align: center;
    }
    
    /* Progress bar */
    .progress-container {
      margin-bottom: 30px;
    }
    .progress-bar-wrapper {
      background-color: var(--gray-200);
      border-radius: 10px;
      overflow: hidden;
      height: 10px;
      margin-bottom: 8px;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      border-radius: 10px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: var(--text-light);
      font-weight: 600;
    }
    
    /* Question */
    .question-title {
      font-size: 1.4em;
      font-weight: 700;
      margin-bottom: 30px;
      color: var(--text-dark);
      line-height: 1.5;
      text-align: center;
    }
    
    /* Options container */
    .options-container {
      margin-bottom: 30px;
      display: grid;
      gap: 15px;
    }
    
    .option-label {
      display: flex;
      align-items: center;
      padding: 18px 22px;
      border-radius: 12px;
      border-left: 5px solid;
      background: var(--white);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.06);
    }

    .option-label:nth-child(1) { border-color: var(--blue-color); }
    .option-label:nth-child(2) { border-color: var(--warning-color); }
    .option-label:nth-child(3) { border-color: var(--success-color); }
    .option-label:nth-child(4) { border-color: var(--pink-color); }

    .option-label:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }

    .option-label:nth-child(1):hover { background: linear-gradient(to right, rgba(59, 130, 246, 0.08), var(--white)); }
    .option-label:nth-child(2):hover { background: linear-gradient(to right, rgba(245, 158, 11, 0.08), var(--white)); }
    .option-label:nth-child(3):hover { background: linear-gradient(to right, rgba(16, 185, 129, 0.08), var(--white)); }
    .option-label:nth-child(4):hover { background: linear-gradient(to right, rgba(236, 72, 153, 0.08), var(--white)); }

    .option-label input[type="radio"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .option-text {
      padding-left: 40px;
      position: relative;
      cursor: pointer;
      display: inline-block;
      transition: all 0.2s ease;
      font-weight: 600;
      color: var(--text-medium);
      width: 100%;
    }

    .option-text::before { /* Custom radio button indicator circle */
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 22px;
      height: 22px;
      border: 2px solid var(--gray-300);
      border-radius: 50%;
      transition: all 0.2s ease;
    }
    
    .option-text::after { /* Custom radio button indicator dot */
      content: "";
      position: absolute;
      left: 7px; /* (22-8)/2 + 2px border offset for parent */
      top: 50%;
      transform: translateY(-50%) scale(0);
      width: 10px;
      height: 10px;
      border-radius: 50%;
      transition: all 0.2s ease;
    }
    
    /* Letter indicators (A, B, C, D) - using ::after on .option-label itself for positioning */
    .option-label .option-indicator {
      position: absolute;
      left: -2px; /* Slightly overlap for visual effect with border */
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      z-index: 5;
      line-height: 1; /* Ensure text is centered */
    }

    .option-label:nth-child(1) .option-indicator { background: var(--blue-color); }
    .option-label:nth-child(2) .option-indicator { background: var(--warning-color); }
    .option-label:nth-child(3) .option-indicator { background: var(--success-color); }
    .option-label:nth-child(4) .option-indicator { background: var(--pink-color); }
    
    /* Selected state for options */
    .option-label input[type="radio"]:checked + .option-text::before {
      border-width: 3px;
    }
    .option-label input[type="radio"]:checked + .option-text::after {
      transform: translateY(-50%) scale(1);
    }

    .option-label:nth-child(1) input[type="radio"]:checked + .option-text::before { border-color: var(--blue-color); }
    .option-label:nth-child(1) input[type="radio"]:checked + .option-text::after { background-color: var(--blue-color); }
    .option-label:nth-child(1):has(input[type="radio"]:checked) {
      background: linear-gradient(to right, rgba(59, 130, 246, 0.12), var(--white));
      box-shadow: 0 3px 10px rgba(59, 130, 246, 0.2);
    }
    .option-label:nth-child(1) input[type="radio"]:checked + .option-text { color: var(--blue-color); font-weight: 700; }


    .option-label:nth-child(2) input[type="radio"]:checked + .option-text::before { border-color: var(--warning-color); }
    .option-label:nth-child(2) input[type="radio"]:checked + .option-text::after { background-color: var(--warning-color); }
    .option-label:nth-child(2):has(input[type="radio"]:checked) {
      background: linear-gradient(to right, rgba(245, 158, 11, 0.12), var(--white));
      box-shadow: 0 3px 10px rgba(245, 158, 11, 0.2);
    }
    .option-label:nth-child(2) input[type="radio"]:checked + .option-text { color: var(--warning-color); font-weight: 700; }

    .option-label:nth-child(3) input[type="radio"]:checked + .option-text::before { border-color: var(--success-color); }
    .option-label:nth-child(3) input[type="radio"]:checked + .option-text::after { background-color: var(--success-color); }
    .option-label:nth-child(3):has(input[type="radio"]:checked) {
      background: linear-gradient(to right, rgba(16, 185, 129, 0.12), var(--white));
      box-shadow: 0 3px 10px rgba(16, 185, 129, 0.2);
    }
    .option-label:nth-child(3) input[type="radio"]:checked + .option-text { color: var(--success-color); font-weight: 700; }

    .option-label:nth-child(4) input[type="radio"]:checked + .option-text::before { border-color: var(--pink-color); }
    .option-label:nth-child(4) input[type="radio"]:checked + .option-text::after { background-color: var(--pink-color); }
    .option-label:nth-child(4):has(input[type="radio"]:checked) {
      background: linear-gradient(to right, rgba(236, 72, 153, 0.12), var(--white));
      box-shadow: 0 3px 10px rgba(236, 72, 153, 0.2);
    }
    .option-label:nth-child(4) input[type="radio"]:checked + .option-text { color: var(--pink-color); font-weight: 700; }
    
    /* Navigation buttons */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 35px;
      padding-top: 25px;
      border-top: 1px solid var(--gray-300);
    }
    
    .btn-nav, .btn-submit {
      background-color: var(--primary-color);
      color: var(--white);
      border: none;
      padding: 14px 28px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 10px rgba(99,102,241,0.2);
    }
     .btn-nav svg, .btn-submit svg {
        width: 18px; height: 18px;
    }
    
    .btn-nav.btn-prev {
      background-color: var(--white);
      color: var(--text-light);
      border: 2px solid var(--gray-300);
      box-shadow: none;
    }
    
    .btn-nav:hover, .btn-submit:hover {
      transform: translateY(-3px);
      background-color: var(--primary-color-dark);
      box-shadow: 0 7px 15px rgba(99, 102, 241, 0.3);
    }
    
    .btn-nav.btn-prev:hover {
      background-color: var(--gray-100);
      border-color: var(--gray-400);
      color: var(--text-medium);
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    
    .btn-nav:active, .btn-submit:active {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(99,102,241,0.2);
    }
    .btn-nav.btn-prev:active {
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .nav-buttons:not(:has(#prevBtn)) { justify-content: flex-end; }
    .single-button { justify-content: flex-end; }
    
    /* Exit modal */
    .exit-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(8px);
    }
    
    .exit-modal.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }
    
    .exit-modal-content {
      background-color: var(--white);
      padding: 35px;
      border-radius: 20px;
      width: 90%;
      max-width: 480px;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
      animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .exit-modal-title {
      font-size: 1.6em;
      font-weight: 700;
      margin-bottom: 18px;
      color: var(--text-dark);
    }
    
    .exit-modal-text {
      margin-bottom: 30px;
      color: var(--text-light);
      font-size: 1.05em;
    }
    
    .exit-modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .exit-modal-button {
      padding: 14px 0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-weight: 700;
      font-size: 1em;
      width: 100%;
    }
    
    .exit-modal-button.cancel {
      background-color: var(--gray-200);
      color: var(--text-medium);
    }
    .exit-modal-button.cancel:hover {
      background-color: var(--gray-300);
      transform: translateY(-2px);
    }
    
    .exit-modal-button.confirm-home {
      background-color: var(--danger-color);
      color: var(--white);
    }
    .exit-modal-button.confirm-home:hover {
      background-color: #D92626; /* Darker red */
      transform: translateY(-2px);
       box-shadow: 0 4px 12px rgba(239,68,68,0.2);
    }
    
    .exit-modal-button.confirm-chat {
      background-color: var(--primary-color);
      color: var(--white);
    }
     .exit-modal-button.confirm-chat:hover {
      background-color: var(--primary-color-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99,102,241,0.2);
    }
    
    /* Animations */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleIn { from { transform: scale(0.9) translateY(10px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
    
    .shake { animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both; }
    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    
    /* Error message */
    .error-message {
      color: var(--danger-color);
      background-color: rgba(239, 68, 68, 0.08);
      padding: 14px 18px;
      border-radius: 10px;
      margin: 20px 0 0; /* Display below options */
      display: flex;
      align-items: center;
      animation: fadeIn 0.3s ease;
      font-weight: 600;
      border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .error-message svg {
      margin-right: 12px;
      flex-shrink: 0;
      stroke: var(--danger-color);
    }
    
    /* Spinner animation */
    .loading-spinner-container {
      text-align: center;
      padding: 50px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(99, 102, 241, 0.2);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 25px;
    }
    .loading-spinner-container p {
      color: var(--text-light);
      font-weight: 600;
      font-size: 1.1em;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .completion-screen {
        text-align: center;
        padding: 40px 30px;
        animation: fadeIn 0.5s ease-out;
    }
    .completion-screen .emoji-celebrate {
        font-size: 60px;
        margin-bottom: 25px;
        display: inline-block;
        animation: tada 1s ease;
    }
    @keyframes tada {
        0% {transform: scale(1);}
        10%, 20% {transform: scale(0.9) rotate(-3deg);}
        30%, 50%, 70%, 90% {transform: scale(1.1) rotate(3deg);}
        40%, 60%, 80% {transform: scale(1.1) rotate(-3deg);}
        100% {transform: scale(1) rotate(0);}
    }
    .completion-screen h3 {
        font-size: 1.8em;
        margin-bottom: 18px;
        color: var(--text-dark);
        font-weight: 700;
    }
    .completion-screen p {
        color: var(--text-light);
        margin-bottom: 35px;
        font-size: 1.1em;
    }


    /* Responsive adjustments */
    @media (max-width: 768px) {
      .main-container { padding-top: 65px; padding-bottom: 20px; }
      .quiz-nav-bar { padding: 15px 20px; }
      .quiz-nav-title { font-size: 1.1em; }
      .quiz-exit-btn { padding: 8px 16px; font-size: 0.85em; }
      
      .quiz-container-wrapper { padding: 20px 15px; }
      #quiz-selection-container { padding: 10px; max-width: 100%;}
      .quiz-selection-title { font-size: 1.6em; margin-bottom: 30px; }
      .quiz-type-option { padding: 20px; max-width: 100%; }
      .quiz-type-emoji { font-size: 2.2rem; margin-right: 15px; }
      .quiz-type-name { font-size: 1.15em; }
      .quiz-type-description { font-size: 0.8em; }
      .quiz-type-arrow { font-size: 1.3rem; }

      .quiz-container { padding: 25px 20px; border-radius: 16px; }
      .question-title { font-size: 1.25em; margin-bottom: 25px; }
      .option-label { padding: 16px 18px; }
      .option-text { padding-left: 35px; font-size: 0.95em; }
      .option-label .option-indicator { width: 24px; height: 24px; font-size: 12px;}
      .option-text::before { width: 20px; height: 20px; }
      .option-text::after { left: 6px; width: 8px; height: 8px; }


      .nav-buttons { flex-direction: column-reverse; gap: 15px; }
      .btn-nav, .btn-submit { width: 100%; padding: 15px; justify-content: center; }
      .nav-buttons:not(:has(#prevBtn)) { flex-direction: column; } /* Ensure single button is also full width */

      .emoji { font-size: 2.2rem; }
      .emoji-top-left { top: 10%; left: 3%; }
      .emoji-top-right { top: 12%; right: 3%; }
      .emoji-bottom-left { bottom: 5%; left: 6%; }
      .emoji-bottom-right { bottom: 8%; right: 6%; }

      .exit-modal-content { padding: 30px 25px; border-radius: 16px; }
      .exit-modal-title { font-size: 1.4em; }
      .exit-modal-text { font-size: 1em; }
      .loading-spinner-container { padding: 30px 20px;}
      .loading-spinner { width: 40px; height: 40px;}
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Top navigation bar -->
    <div class="quiz-nav-bar">
      <h2 class="quiz-nav-title" id="quizNavMainTitle">Tr·∫Øc nghi·ªám √°p l·ª±c ƒë·ªìng trang l·ª©a</h2>
      <div class="quiz-nav-buttons">
        <button class="quiz-exit-btn" id="navBackBtn">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
          </svg>
          <span>Tho√°t</span>
        </button>
      </div>
    </div>
    
    <div class="decorative-elements">
      <div class="emoji emoji-top-left">üò•</div>
      <div class="emoji emoji-top-right">‚ú®</div>
      <div class="emoji emoji-bottom-left">ü´Ä</div>
      <div class="emoji emoji-bottom-right">üåü</div>
    </div>
    
    <div class="quiz-container-wrapper">
      <div id="quiz-selection-container">
        <h2 class="quiz-selection-title">Ch·ªçn lo·∫°i tr·∫Øc nghi·ªám b·∫°n mu·ªën th·ª±c hi·ªán:</h2>
        <div class="quiz-options-list" id="quizOptionsList">
          <!-- Quiz options will be dynamically inserted here -->
        </div>
      </div>
      <div class="quiz-container" id="quiz-container" style="display: none;">
          <!-- Quiz content will be loaded here -->
      </div>
    </div>
  </div>
  
  <div class="exit-modal" id="exitModal">
    <div class="exit-modal-content">
      <h3 class="exit-modal-title">B·∫°n ch·∫Øc ch·∫Øn mu·ªën r·ªùi ƒëi?</h3>
      <p class="exit-modal-text">Ti·∫øn tr√¨nh l√†m b√†i tr·∫Øc nghi·ªám hi·ªán t·∫°i s·∫Ω kh√¥ng ƒë∆∞·ª£c l∆∞u l·∫°i.</p>
      <div class="exit-modal-buttons">
        <button class="exit-modal-button cancel" onclick="hideExitModal()">Ti·∫øp t·ª•c l√†m b√†i</button>
        <button class="exit-modal-button confirm-chat" onclick="exitToChat()">ƒê·∫øn tr√≤ chuy·ªán</button>
        <button class="exit-modal-button confirm-home" onclick="exitToHome()">V·ªÅ trang ch·ªß</button>
      </div>
    </div>
  </div>
  
  <script>
document.addEventListener("DOMContentLoaded", function() {
  let currentQuestion = 0;
  let answers = {};
  let questions = [];
  let originalQuizQuestions = {}; 
  let isTransitioning = false;
  let selectedQuizType = null;
  let selectedQuizName = '';

  const quizTypesData = [
    { key: 'study', name: '√Åp L·ª±c H·ªçc T·∫≠p', emoji: 'üéì', description: 'ƒê√°nh gi√° m·ª©c ƒë·ªô cƒÉng th·∫≥ng li√™n quan ƒë·∫øn k·∫øt qu·∫£ h·ªçc t·∫≠p v√† k·ª≥ v·ªçng.', active: true },
    { key: 'nghinh', name: '√Åp L·ª±c V·ªÅ Ngo·∫°i H√¨nh', emoji: 'üíÖ', description: 'Kh√°m ph√° ·∫£nh h∆∞·ªüng c·ªßa ti√™u chu·∫©n ngo·∫°i h√¨nh t·ª´ b·∫°n b√® v√† x√£ h·ªôi.', active: true },
    { key: 'hobby', name: '√Åp L·ª±c S·ªü Th√≠ch & Th√≥i Quen', emoji: 'üé®', description: 'T√¨m hi·ªÉu v·ªÅ √°p l·ª±c ph·∫£i theo ƒëu·ªïi s·ªü th√≠ch ho·∫∑c th√≥i quen gi·ªëng b·∫°n b√®.', active: true },
    { key: 'finace', name: '√Åp L·ª±c V·ªÅ T√†i Ch√≠nh', emoji: 'üí∞', description: 'ƒêo l∆∞·ªùng m·ª©c ƒë·ªô lo l·∫Øng v·ªÅ v·∫•n ƒë·ªÅ t√†i ch√≠nh c√° nh√¢n so v·ªõi b·∫°n b√®.', active: true },
    { key: 'lifestyle', name: '√Åp L·ª±c V·ªÅ Phong C√°ch S·ªëng', emoji: '‚ú®', description: 'ƒê√°nh gi√° √°p l·ª±c li√™n quan ƒë·∫øn vi·ªác duy tr√¨ m·ªôt phong c√°ch s·ªëng nh·∫•t ƒë·ªãnh.', active: true}
  ];

  const quizSelectionContainer = document.getElementById('quiz-selection-container');
  const quizContainer = document.getElementById('quiz-container');
  const quizOptionsList = document.getElementById('quizOptionsList');
  const quizNavMainTitle = document.getElementById('quizNavMainTitle');

  // *** KHAI B√ÅO V√Ä G·∫ÆN EVENT CHO N√öT THO√ÅT ***
  const navBackBtn = document.getElementById('navBackBtn'); 
  if (navBackBtn) { // Ki·ªÉm tra xem n√∫t c√≥ t·ªìn t·∫°i kh√¥ng tr∆∞·ªõc khi g·∫Øn listener
    navBackBtn.addEventListener('click', (event) => {
      event.preventDefault(); // Quan tr·ªçng n·∫øu n√∫t l√† <a>, c≈©ng t·ªët cho <button>
      showExitModal();
    });
  }
  // *** K·∫æT TH√öC PH·∫¶N N√öT THO√ÅT ***

  function renderQuizSelection() {
    quizOptionsList.innerHTML = ''; // Clear previous options
    quizTypesData.forEach(quizType => {
      const optionDiv = document.createElement('div');
      optionDiv.className = `quiz-type-option ${quizType.active ? 'active-option' : 'disabled-option'}`;
      optionDiv.innerHTML = `
        <div class="quiz-type-emoji">${quizType.emoji}</div>
        <div class="quiz-type-content">
            <div class="quiz-type-name">${quizType.name}</div>
            ${quizType.description ? `<div class="quiz-type-description">${quizType.description}</div>` : ''}
        </div>
        <div class="quiz-type-arrow">‚ûî</div>
      `;
      if (quizType.active) {
        optionDiv.addEventListener('click', () => selectQuizType(quizType.key, quizType.name));
      }
      quizOptionsList.appendChild(optionDiv);
    });
    quizSelectionContainer.style.display = 'flex';
    quizContainer.style.display = 'none';
    quizNavMainTitle.textContent = 'Tr·∫Øc nghi·ªám √°p l·ª±c ƒë·ªìng trang l·ª©a';
  }

  function selectQuizType(typeKey, typeName) {
    selectedQuizType = typeKey;
    selectedQuizName = typeName;
    
    quizNavMainTitle.textContent = `Tr·∫Øc nghi·ªám ${typeName}`;
    quizSelectionContainer.style.display = 'none';
    quizContainer.style.display = 'block';
    quizContainer.innerHTML = ''; // Clear previous quiz content
    resetQuizState();
    loadQuestions();
  }
  
  function resetQuizState() {
    currentQuestion = 0;
    answers = {};
    questions = [];
    originalQuizQuestions = {};
    isTransitioning = false;
  }

  async function loadQuestions() {
    if (!selectedQuizType) return;

    try {
      quizContainer.innerHTML = `
        <div style="text-align: center; padding: 30px;">
          <div style="width: 40px; height: 40px; border: 4px solid rgba(99, 102, 241, 0.3); border-top-color: #6366F1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
          <p style="color: #6B7280;">ƒêang t·∫£i c√¢u h·ªèi...</p>
        </div>
      `;
      
      const response = await fetch(`/api/questions?quiz_type=${selectedQuizType}`);
      if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i c√¢u h·ªèi t·ª´ server');
      
      const originalResponse = await fetch(`/api/questions?quiz_type=${selectedQuizType}`);
      if (!originalResponse.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i c√¢u h·ªèi g·ªëc t·ª´ server');
      originalQuizQuestions = await originalResponse.json();
      
      let data = await response.json();
      
      if (!data || (Array.isArray(data) && data.length === 0) || (typeof data === 'object' && Object.keys(data).length === 0) ) {
        throw new Error('Kh√¥ng c√≥ c√¢u h·ªèi n√†o cho lo·∫°i tr·∫Øc nghi·ªám n√†y ho·∫∑c n·ªôi dung ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t.');
      }

      if (!Array.isArray(data)) {
        data = Object.keys(data).map(key => data[key]);
      }
      questions = data;
      showQuestion();
      
    } catch (error) {
      quizContainer.innerHTML = `
        <div style="text-align: center; padding: 30px;">
          <div style="color: #EF4444; font-size: 40px; margin-bottom: 20px;">‚ö†Ô∏è</div>
          <h3 style="margin-bottom: 10px; color: #1F2937;">ƒê√£ x·∫£y ra l·ªói</h3>
          <p style="color: #6B7280; margin-bottom: 20px;">${error.message}</p>
          <button onclick="renderQuizSelectionScreen()" style="background: #6366F1; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer;">Ch·ªçn l·∫°i Quiz</button>
        </div>
      `;
    }
  }
  window.renderQuizSelectionScreen = renderQuizSelection;


  function showQuestion() {
    if (isTransitioning) return;
    isTransitioning = true;
    
    if (currentQuestion >= questions.length) {
      const completionContent = `
        <div style="text-align: center; padding: 30px;">
          <div style="font-size: 50px; margin-bottom: 20px;">üéâ</div>
          <h3 style="font-size: 1.5em; margin-bottom: 15px; color: #1F2937;">Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh b√†i tr·∫Øc nghi·ªám</h3>
          <p style="color: #6B7280; margin-bottom: 30px;">Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ xem k·∫øt qu·∫£ c·ªßa b·∫°n</p>
          <button onclick="submitQuiz()" class="btn-submit" style="margin: 0 auto; display: inline-flex;">Xem k·∫øt qu·∫£</button>
        </div>
      `;
      
      quizContainer.style.opacity = '0';
      quizContainer.style.transform = 'translateY(10px)';
      quizContainer.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
      
      setTimeout(() => {
        quizContainer.innerHTML = completionContent;
        quizContainer.style.opacity = '1';
        quizContainer.style.transform = 'translateY(0)';
        isTransitioning = false;
      }, 300);
      return;
    }

    const q = questions[currentQuestion];
    const progressPercent = ((currentQuestion + 1) / questions.length) * 100;
    
    const optionsHTML = Object.entries(q.options).map(([key, value]) => {
      const isChecked = answers[q.id] === key ? 'checked' : '';
      return `
        <label class="option-label">
          <input type="radio" name="answer" value="${key}" ${isChecked}>
          <span class="option-text">${value}</span>
        </label>
      `;
    }).join('');

    const isFirstQuestion = currentQuestion === 0;
    const navButtonsClass = isFirstQuestion ? 'nav-buttons single-button' : 'nav-buttons';

    const questionContent = `
      <div class="quiz-title">C√¢u h·ªèi ${currentQuestion + 1}/${questions.length}</div>
      <div class="progress-container">
        <div class="progress-bar" style="width: 0%"></div>
        <div class="progress-text">
          <span>Ti·∫øn tr√¨nh</span>
          <span>${currentQuestion + 1}/${questions.length}</span>
        </div>
      </div>
      <h3 class="question-title">${q.question}</h3>
      <div class="options-container">${optionsHTML}</div>
      <div class="${navButtonsClass}">
        ${currentQuestion > 0 ? '<button id="prevBtn" class="btn-nav btn-prev">Tr∆∞·ªõc</button>' : ''}
        <button id="nextBtn" class="btn-nav">${currentQuestion === questions.length - 1 ? 'Ho√†n th√†nh' : 'Ti·∫øp theo'}</button>
      </div>
    `;
    
    quizContainer.style.opacity = '0';
    quizContainer.style.transform = 'translateY(10px)';
    quizContainer.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    
    setTimeout(() => {
      quizContainer.innerHTML = questionContent;
      quizContainer.style.opacity = '1';
      quizContainer.style.transform = 'translateY(0)';
      setTimeout(() => {
        const progressBar = document.querySelector('.progress-bar');
        if(progressBar) progressBar.style.width = `${progressPercent}%`;
      }, 100);
      setupListeners();
      isTransitioning = false;
    }, 300);
  }

  function setupListeners() {
    const prevBtn = document.getElementById('prevBtn');
    if (prevBtn) prevBtn.addEventListener('click', prevQuestion);
    
    const nextBtn = document.getElementById('nextBtn');
    if (nextBtn) nextBtn.addEventListener('click', nextQuestion);
    
    const options = document.querySelectorAll('.option-label');
    options.forEach(option => {
      option.addEventListener('click', function() {
        const radio = this.querySelector('input[type="radio"]');
        if (radio) radio.checked = true;
      });
    });
  }
  
  function prevQuestion() {
    if (isTransitioning || currentQuestion <= 0) return;
    currentQuestion--;
    showQuestion();
  }
  
  function nextQuestion() {
    if (isTransitioning) return;
    
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) {
      const optionsContainer = document.querySelector('.options-container');
      if(optionsContainer) optionsContainer.classList.add('shake');
      setTimeout(() => {
        if(optionsContainer) optionsContainer.classList.remove('shake');
      }, 500);
      
      if (!document.querySelector('.error-message')) {
        const errorMsg = document.createElement('div');
        errorMsg.className = 'error-message';
        errorMsg.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" 
              stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Vui l√≤ng ch·ªçn m·ªôt c√¢u tr·∫£ l·ªùi ƒë·ªÉ ti·∫øp t·ª•c
        `;
        const optionsCont = document.querySelector('.options-container');
        if(optionsCont) optionsCont.insertAdjacentElement('afterend', errorMsg);
        setTimeout(() => {
          errorMsg.style.opacity = '0';
          errorMsg.style.transform = 'translateY(-10px)';
          errorMsg.style.transition = 'all 0.3s ease';
          setTimeout(() => { if (errorMsg.parentNode) errorMsg.remove(); }, 300);
        }, 3000);
      }
      return;
    }
    
    const q = questions[currentQuestion];
    answers[q.id] = selected.value;
    currentQuestion++;
    showQuestion();
  }

  window.submitQuiz = async function submitQuiz() {
    try {
      const payload = {
        quiz_type: selectedQuizType, 
        answers: Object.entries(answers).map(([questionId, selectedAnswer]) => {
          const question = questions.find(q => q.id == questionId);
          if (!question) throw new Error(`Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi v·ªõi ID=${questionId}`);
          const originalId = question.original_id;
          const answerText = question.options[selectedAnswer];
          return { question_id: originalId, answer: answerText };
        })
      };

      const response = await fetch('/api/submit?quiz_type=${selectedQuizType}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(errorText || 'N·ªôp b√†i kh√¥ng th√†nh c√¥ng');
      }

      const result = await response.json();
      if (result.detailed_scores) localStorage.setItem('detailedScores', JSON.stringify(result.detailed_scores));
      if (result.detailed_answers) localStorage.setItem('detailedAnswers', JSON.stringify(result.detailed_answers));
      
      window.location.href = `/result?score=${result.total_score}&assessment=${encodeURIComponent(result.assessment)}&detailed_scores=${encodeURIComponent(JSON.stringify(result.detailed_scores))}&detailed_answers=${encodeURIComponent(JSON.stringify(result.detailed_answers))}`;
    } catch (err) {
      console.error('Error submitting quiz:', err);
      alert(`L·ªói n·ªôp b√†i: ${err.message}`);
    }
  };

window.showExitModal = function() {
    document.getElementById('exitModal').classList.add('active');
  };
  window.hideExitModal = function() {
    document.getElementById('exitModal').classList.remove('active');
  };
  window.exitToHome = function() {
    window.location.href = '/';
  };
  window.exitToChat = function() {
    window.location.href = '/chat';
  };
  // Initial render
  renderQuizSelection();

  document.addEventListener('keydown', function(event) {
    const activeElement = document.activeElement;
    if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
        return;
    }

    const preventDefaultKeys = ['ArrowLeft', 'ArrowRight', 'Enter', ' ', 'Escape'];
    if (preventDefaultKeys.includes(event.key) && quizContainer.style.display === 'block') { 
      event.preventDefault();
    }

    if (quizContainer.style.display === 'block' && !isTransitioning) { 
      switch(event.key) {
        case 'ArrowRight':
        case 'Enter':
        case ' ': 
          const nextBtn = document.getElementById('nextBtn');
          if (nextBtn) {
            nextBtn.click();
          } else if (currentQuestion >= questions.length) { 
            submitQuiz();
          }
          break;
        case 'ArrowLeft':
          const prevBtn = document.getElementById('prevBtn');
          if (prevBtn) prevBtn.click();
          break;
        case '1': case '2': case '3': case '4':
          const optionIndex = parseInt(event.key) - 1;
          const radioOptions = document.querySelectorAll('.option-label input[type="radio"]');
          if (radioOptions[optionIndex]) radioOptions[optionIndex].checked = true;
          break;
      }
    }
    if (event.key === 'Escape') { 
        showExitModal();
    }
  });
});
  </script>
</body>
</html>
